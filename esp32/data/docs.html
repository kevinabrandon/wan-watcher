<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAN Watcher Documentation</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #1a1a1a;
            color: #ccc;
            display: flex;
            height: 100vh;
        }
        /* Sidebar */
        .sidebar {
            width: 250px;
            min-width: 250px;
            background: #111;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid #333;
            background: #0a0a0a;
        }
        .sidebar-header h1 {
            font-size: 16px;
            color: #0f0;
            margin-bottom: 8px;
        }
        .sidebar-header a {
            color: #888;
            font-size: 12px;
            text-decoration: none;
        }
        .sidebar-header a:hover {
            color: #0f0;
        }
        .toc {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }
        .toc-item {
            display: block;
            padding: 10px 16px;
            color: #aaa;
            text-decoration: none;
            font-size: 14px;
            border-left: 3px solid transparent;
            transition: all 0.15s;
        }
        .toc-item:hover {
            background: #222;
            color: #fff;
        }
        .toc-item.active {
            background: #1a2a1a;
            color: #0f0;
            border-left-color: #0f0;
        }
        /* Content */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 32px 48px;
        }
        .content h1 {
            color: #0f0;
            border-bottom: 1px solid #333;
            padding-bottom: 12px;
            margin-bottom: 24px;
        }
        .content h2 {
            color: #0f0;
            margin-top: 32px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }
        .content h3 {
            color: #0c0;
            margin-top: 24px;
            margin-bottom: 12px;
        }
        .content p {
            line-height: 1.7;
            margin-bottom: 16px;
        }
        .content a {
            color: #4a9eff;
        }
        .content a:hover {
            color: #7bb8ff;
        }
        .content code {
            background: #2a2a2a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "SF Mono", Consolas, monospace;
            font-size: 13px;
        }
        .content pre {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 16px;
            overflow-x: auto;
            margin-bottom: 16px;
        }
        .content pre code {
            background: none;
            padding: 0;
            font-size: 13px;
            line-height: 1.5;
        }
        .content ul, .content ol {
            margin-left: 24px;
            margin-bottom: 16px;
            line-height: 1.7;
        }
        .content li {
            margin-bottom: 4px;
        }
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }
        .content th, .content td {
            border: 1px solid #333;
            padding: 8px 12px;
            text-align: left;
        }
        .content th {
            background: #222;
            color: #0f0;
        }
        .content tr:nth-child(even) {
            background: #1a1a1a;
        }
        .content img {
            max-width: 100%;
            border-radius: 6px;
            margin: 16px 0;
        }
        .content blockquote {
            border-left: 4px solid #0f0;
            margin: 16px 0;
            padding: 12px 16px;
            background: #1a2a1a;
            color: #aaa;
        }
        .content hr {
            border: none;
            border-top: 1px solid #333;
            margin: 32px 0;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #f66;
            padding: 16px;
            background: #2a1a1a;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <h1>wan-watcher</h1>
            <a href="/">&larr; Back to Dashboard</a>
        </div>
        <div class="toc" id="toc"></div>
    </nav>
    <main class="content" id="content">
        <p class="loading">Loading documentation...</p>
    </main>

    <script>
        const docs = [
            { id: 'readme', title: 'README', path: '/docs/README.md' },
            { id: 'hardware', title: 'Hardware', path: '/docs/hardware.md' },
            { id: 'pfsense', title: 'pfSense Installation', path: '/docs/pfsense-install.md' },
            { id: 'api', title: 'API Reference', path: '/docs/api.md' },
            { id: 'troubleshooting', title: 'Troubleshooting', path: '/docs/troubleshooting.md' }
        ];

        const tocEl = document.getElementById('toc');
        const contentEl = document.getElementById('content');

        // Build TOC
        docs.forEach(doc => {
            const a = document.createElement('a');
            a.href = `#${doc.id}`;
            a.className = 'toc-item';
            a.textContent = doc.title;
            a.dataset.path = doc.path;
            a.onclick = (e) => {
                e.preventDefault();
                loadDoc(doc.id);
            };
            tocEl.appendChild(a);
        });

        // Configure marked for GitHub-style markdown
        marked.setOptions({
            gfm: true,
            breaks: false
        });

        async function loadDoc(id) {
            const doc = docs.find(d => d.id === id);
            if (!doc) return;

            // Update URL hash
            history.replaceState(null, '', `#${id}`);

            // Update active state
            document.querySelectorAll('.toc-item').forEach(el => {
                el.classList.toggle('active', el.dataset.path === doc.path);
            });

            // Show loading
            contentEl.innerHTML = '<p class="loading">Loading...</p>';

            try {
                const response = await fetch(doc.path);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                let markdown = await response.text();

                // Fix relative image paths for README
                if (id === 'readme') {
                    markdown = markdown.replace(/\(\.\/images\//g, '(/docs/images/');
                    markdown = markdown.replace(/\(\.\/docs\//g, '(/docs/');
                }

                // Fix relative paths in docs files
                markdown = markdown.replace(/\(\.\/diagrams\//g, '(/docs/diagrams/');

                contentEl.innerHTML = marked.parse(markdown);
            } catch (err) {
                contentEl.innerHTML = `<div class="error">Failed to load ${doc.path}: ${err.message}</div>`;
            }
        }

        // Load initial doc from hash or default to readme
        const initialDoc = location.hash.slice(1) || 'readme';
        loadDoc(initialDoc);
    </script>
</body>
</html>
